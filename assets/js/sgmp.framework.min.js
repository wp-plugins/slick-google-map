(function(){if(typeof jQuery==="undefined"||jQuery==null){var b=false;var d=document.head||document.getElementsByTagName("head")[0]||document.documentElement;var c=document.createElement("script");c.type="text/javascript";c.src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js";c.onload=c.onreadystatechange=function(){if(!b&&(!this.readyState||/loaded|complete/.test(c.readyState))){b=true;var e=jQuery.noConflict();a(e);c.onload=c.onreadystatechange=null;if(d&&c.parentNode){d.removeChild(c)}c=undefined}};d.appendChild(c)}else{a()}function a(){var e=(typeof arguments[0]==="undefined"||arguments[0]==null||!arguments[0])?jQuery:arguments[0];(function(j){var o=function(s){};var f=parseFloat(j.fn.jquery.split(".")[0]);var r=parseFloat(j.fn.jquery.split(".")[1]);if(f>=1&&f<2&&r>=4){o=j.parseJSON}else{if(window.JSON&&window.JSON.parse){o=window.JSON.parse}else{g.fatal("Using parseJson stub..")}}var k=(function(){var u={};var v={};var s=function s(C,w,z,B,y){v=C;var A=[];for(var x in google.maps.MapTypeId){A.push(google.maps.MapTypeId[x])}if(B=="OSM"){A.push(B);v.mapTypes.set(B,new google.maps.ImageMapType({getTileUrl:function(E,D){return"http://tile.openstreetmap.org/"+D+"/"+E.x+"/"+E.y+".png"},tileSize:new google.maps.Size(256,256),name:"OpenStreet",maxZoom:20}))}else{if(B=="roadmap".toUpperCase()){B=google.maps.MapTypeId.ROADMAP}else{if(B=="satellite".toUpperCase()){B=google.maps.MapTypeId.SATELLITE}else{if(B=="hybrid".toUpperCase()){B=google.maps.MapTypeId.HYBRID}else{if(B=="terrain".toUpperCase()){B=google.maps.MapTypeId.TERRAIN}}}}}v.setOptions({zoom:z,mapTypeId:B,styles:y,mapTypeControlOptions:{mapTypeIds:A}})};var t=function t(w){v.setOptions(w)};return{initMap:s,setMapControls:t}})();var q=(function(){var y={};var x=function x(z){y=z};var u=function u(){var z=new google.maps.TrafficLayer();z.setMap(y)};var t=function t(){var z=new google.maps.BicyclingLayer();z.setMap(y)};var w=function w(A){if(typeof google.maps.panoramio==="undefined"||!google.maps.panoramio||google.maps.panoramio==null){g.error("We cannot access Panoramio library. Aborting..");return false}var z=new google.maps.panoramio.PanoramioLayer();if(z){if(A!=null&&A!=""){z.setUserId(A)}z.setMap(y)}else{g.error("Could not instantiate Panoramio object. Aborting..")}};var s=function s(z){if(z.toLowerCase().indexOf("http")<0){g.error("KML URL must start with HTTP(S). Aborting..");return false}var A=new google.maps.KmlLayer(z);google.maps.event.addListener(A,"status_changed",function(){v(A)});google.maps.event.addListener(A,"defaultviewport_changed",function(){});A.setMap(y)};function v(B){var A=B.getStatus();if(A==google.maps.KmlLayerStatus.OK){}else{var C="";switch(A){case google.maps.KmlLayerStatus.DOCUMENT_NOT_FOUND:C=SGMPGlobal.kmlNotFound;break;case google.maps.KmlLayerStatus.DOCUMENT_TOO_LARGE:C=SGMPGlobal.kmlTooLarge;break;case google.maps.KmlLayerStatus.FETCH_ERROR:C=SGMPGlobal.kmlFetchError;break;case google.maps.KmlLayerStatus.INVALID_DOCUMENT:C=SGMPGlobal.kmlDocInvalid;break;case google.maps.KmlLayerStatus.INVALID_REQUEST:C=SGMPGlobal.kmlRequestInvalid;break;case google.maps.KmlLayerStatus.LIMITS_EXCEEDED:C=SGMPGlobal.kmlLimits;break;case google.maps.KmlLayerStatus.TIMED_OUT:C=SGMPGlobal.kmlTimedOut;break;case google.maps.KmlLayerStatus.UNKNOWN:C=SGMPGlobal.kmlUnknown;break}if(C!=""){var z=SGMPGlobal.kml.replace("[TITLE]","<b>Slick Google Map Plugin</b><br /><br /><b>Google KML error:</b><br />");z=z.replace("[MSG]",C);z=z.replace("[STATUS]",A);g.error("Google returned KML error: "+C+" ("+A+")");g.error("KML file: "+B.getUrl())}}}return{init:x,buildKmlLayer:s,buildTrafficLayer:u,buildBikeLayer:t,buildPanoramioLayer:w}})();var i=function(){var aj,ah,U,M,I,ad,ai,x,y,u,L,z,C,R,D,X,Y,T,N,ac;var W=null;var w=false;var t=false;var H=false;var aa=[];var Q=[];var B={};var ag=function ag(am,ao,al,an){Q=an;x=am;R=x.getDiv().id;u=ao;M=al;t=an.enablemarkerclustering!=="false";B=google.maps.event.addListener(x,"click",function(){Z()});aj=[];U=[];ah=[];C=5;ad=null;y=null;z=null;L=null;ai=false;I=false;D=new google.maps.Geocoder();X=new google.maps.LatLngBounds();Y=new google.maps.InfoWindow();T=new google.maps.StreetViewService();ac=new google.maps.DirectionsService();rendererOptions={draggable:true};N=new google.maps.DirectionsRenderer(rendererOptions);N.setPanel(document.getElementById("rendered-directions-placeholder-"+R))};var S=function S(al){if(al==="true"){if(is_mobile_device()){W=new J();google.maps.event.addListenerOnce(W,"position_changed",function(){x.setCenter(this.getPosition());x.fitBounds(this.getBounds())});google.maps.event.addListener(W,"geolocation_error",function(am){g.error("There was an error obtaining your position. Message: "+am.message);W=null});W.setPositionOptions({enableHighAccuracy:true,timeout:6000,maximumAge:0});W.setMap(x)}}};var ae=function ae(){return I};function ab(){clearTimeout(ad);if(ah.length>0){var an=ah.shift();g.info("Geocoding '"+an.address+"' Left "+ah.length+" items to geocode..");var av={address:an.address};D.geocode(av,function(aA,az){F(aA,az,an)})}else{E();if(t){var ay=false;var at=document.head||document.getElementsByTagName("head")[0]||document.documentElement;var au=document.createElement("script");au.type="text/javascript";au.src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/src/markerclusterer_compiled.js";au.onload=au.onreadystatechange=function(){if(!ay&&(!this.readyState||/loaded|complete/.test(au.readyState))){ay=true;google.maps.event.removeListener(B);markerClusterer=new MarkerClusterer(x,aj,{averageCenter:true,zoomOnClick:true});au.onload=au.onreadystatechange=null;if(at&&au.parentNode){at.removeChild(au)}au=undefined}};at.appendChild(au)}if(H){g.warn("Reset server map data cache required");if(w){j.each(aj,function(aB,aA){var az=(aA.position+"").replace(new RegExp("\\(|\\)","g"),"");j.each(aa,function(aD,aC){if(aD===aA.content){if(aC.validated_address_csv_data.indexOf(SGMPGlobal.geoValidationClientRevalidate)!=-1){aC.validated_address_csv_data=aC.validated_address_csv_data.replace(new RegExp(SGMPGlobal.geoValidationClientRevalidate,"g"),az);return false}}})});var ax=JSON.stringify(aa);j.post(SGMPGlobal.ajaxurl,{action:SGMPGlobal.ajaxCacheMapAction,data:ax,geoMashup:"true",timestamp:SGMPGlobal.timestamp},function(az){g.info("Posting map data to the server..");if(az!=null&&az==="OK"){g.info("Map geo mashup cache was reset on the server")}})}else{var ap=Q.markerlist.split("|");var ao=Q.debug.widget_id;var al=Q.debug.post_id;var am=Q.debug.post_type;var aw=Q.debug.shortcodeid;var ar=[];j.each(aj,function(aA,aB){var az=(aB.position+"").replace(new RegExp("\\(|\\)","g"),"");j.each(ap,function(aC,aD){var aE=aD.split(SGMPGlobal.sep);if(aE[0]===aB.content){g.info(aE[0]+" matched "+aB.content+" (marker#"+(aA+1)+")");if(aD.indexOf(SGMPGlobal.geoValidationClientRevalidate)!=-1){ar[aA]=aD.replace(new RegExp(SGMPGlobal.geoValidationClientRevalidate,"g"),az)}else{ar[aA]=aD}return false}})});var aq=ar.join("|");if(typeof ao!=="undefined"&&ao!=="undefined"){j.post(SGMPGlobal.ajaxurl,{action:SGMPGlobal.ajaxCacheMapAction,data:aq,geoMashup:"false",widgetId:ao,timestamp:SGMPGlobal.timestamp},function(az){g.info("Posting map data to the server..");if(az!=null){if(az==="OK_WIDGET"){g.info("Map cache was reset on the server for widget#"+ao)}}})}else{if(typeof al!=="undefined"&&al!=="undefined"){j.post(SGMPGlobal.ajaxurl,{action:SGMPGlobal.ajaxCacheMapAction,data:aq,geoMashup:"false",postId:al,postType:am,shortcodeId:aw,timestamp:SGMPGlobal.timestamp},function(az){g.info("Posting map data to the server..");if(az!=null){if(az==="OK_POST"){g.info("Map cache was reset on the server for post#"+al+" shortcode#"+aw)}else{if(az==="OK_PAGE"){g.info("Map cache was reset on the server for page#"+al+" shortcode#"+aw)}else{if(az==="OK_CUSTOM"){g.info("Map cache was reset on the server for type "+am+"#"+al+" shortcode#"+aw)}}}}})}}}H=false}g.info("Have "+(aj.length)+" markers on the map")}}function F(ao,al,an){if(al==google.maps.GeocoderStatus.OK){g.info("Geocoding '"+an.address+"' OK!");var am=ao[0].geometry.location;af(am,an);ad=setTimeout(function(){ab()},200)}else{if(al==google.maps.GeocoderStatus.OVER_QUERY_LIMIT){g.warn("Geocoding '"+an.address+"' OVER_QUERY_LIMIT!");E();ah.push(an);ad=setTimeout(function(){ab()},2200)}else{if(al==google.maps.GeocoderStatus.ZERO_RESULTS){g.warn("Geocoding '"+an.address+"' ZERO_RESULTS!");ad=setTimeout(function(){ab()},200)}else{g.warn("Geocoding '"+an.address+"' "+al+"!");ad=setTimeout(function(){ab()},200)}}}}var P=function P(ao,al,an){I=true;y=l.trim(ao);y=l.searchReplace(y,"'","");if(al==="true"){w=true;var am=o(y);if(an==="true"){G(am,true)}else{if(an==="false"){G(am,false)}}}else{if(al==null||al==="false"){ak(y,"","","",false,false)}}E();ab()};function G(am,an){var al=1;aa=am;j.each(am,function(ao,ap){if(ao==="live_debug"||ao==="debug"){return true}if(this.excerpt==null){this.excerpt=""}if(typeof this.validated_address_csv_data==="undefined"||this.validated_address_csv_data===""){g.error("Validated address from: "+this.permalink+" returned empty, perhaps OVER_QUERY_LIMIT when validating on the server..")}ak(this.validated_address_csv_data,this.title,this.permalink,this.excerpt,an,true);al++})}function ak(az,aC,ap,al,av,aA){if(typeof az==="undefined"||az===""){g.fatal("Not parsing empty validated address csv data.. Skipping");return}g.info("Raw: "+az);var ax=az.split("|");for(var ao=0;ao<ax.length;ao++){var au=ax[ao];if(au!=null&&au!=""){var aw=au.split(SGMPGlobal.sep);var an=aw[0];var aq=aw[1];var at=aw[2];var ay=aw[3];if(at.indexOf(SGMPGlobal.noBubbleDescriptionProvided)!=-1){at=""}var am={address:an,animation:google.maps.Animation.DROP,zIndex:(ao+1),markerIcon:aq,customBubbleText:at,markerHoverText:at+" ("+an+")",postTitle:aC,postLink:ap,postExcerpt:al,infoBubbleContainPostLink:av,geoMashup:aA};if(ay===SGMPGlobal.geoValidationClientRevalidate){H=true;ah.push(am);continue}var ar=[];if(ay.indexOf(",")!=-1){ar=ay.split(",")}else{if(ay.indexOf(";")!=-1){ar=ay.split(";")}}ar[0]=l.trim(ar[0]);ar[1]=l.trim(ar[1]);if(ar[0]===""||ar[1]===""){g.warn("Lat or Long are empty string");return false}var aB=new google.maps.LatLng(parseFloat(ar[0]),parseFloat(ar[1]));af(aB,am)}}}function af(am,ao){var an=new google.maps.Marker({position:am,title:ao.markerHoverText,content:ao.address,zIndex:(ao.zIndex+1000),map:x});if(an){g.info("Built marker: "+ao.address+" "+am);if(ao.markerIcon){var al=ao.markerIcon;if(typeof al=="undefined"||al==="undefined"){al="1-default.png"}if(al!=="1-default.png"){an.setIcon(SGMPGlobal.customMarkersUri+al)}}s(an,ao);if(!ai){A();ai=true}aj.push(an)}}function E(){var am=false;var al=W==null?false:true;if(aj.length>1){j.each(aj,function(ao,an){if(!X.contains(an.position)){X.extend(an.position)}});am=true}else{if(aj.length==1){if(al){X.extend(aj[0].position);am=true}else{x.setCenter(aj[0].position);C=x.getZoom();z=x.getCenter()}}}if(am){if(al){if(W.getPosition()!=null){g.info("Extended bounds with Geo marker position: "+W.getPosition());X.extend(W.getPosition())}}L=X;if(X!=null){x.fitBounds(X)}}}function Z(){if(L!=null){if(x.getCenter()!=L.getCenter()){g.info("Panning map back to its original bounds center: "+L.getCenter());x.fitBounds(L);x.setCenter(L.getCenter())}}else{if(z!=null){g.info("Panning map back to its original center: "+z+" and updated zoom: "+C);x.setCenter(z);x.setZoom(C)}}}function V(al){j(al+" input#a_address").val("");j(al+" input#b_address").val("");j(al+" input#a_address").removeClass("d_error");j(al+" input#b_address").removeClass("d_error");j("input#"+R+"_avoid_hway").prop("checked",false);j("input#"+R+"_avoid_tolls").prop("checked",false);j("input#"+R+"_radio_km").prop("checked",false);j("input#"+R+"_radio_miles").prop("checked",true)}function s(am,an){var ap=v(am.content,an);var al="div#direction-controls-placeholder-"+R;var ao=j("div#rendered-directions-placeholder-"+R);google.maps.event.addListener(am,"click",function(){V(al);j(al).fadeOut();N.setMap(null);ao.html("");ao.hide();j(al+" button#print_sub").hide();O(am,ap,al);K(am,ap,al,ao);Y.setContent(ap.bubbleContent);Y.setOptions({disableAutoPan:u==="true"?false:true});Y.open(x,this)})}function K(am,ar,al,aq){var at="div#bubble-"+ar.bubbleHolderId;var ao=am.content;ao=ao.replace("Lat/Long: ","");var an=W==null?false:true;var ap=an==false||W.getPosition()==null?"":W.getPosition();j(document).on("click",at+" a.dirToHereTrigger",function(){var au=this.id;if(au==="toHere-"+ar.bubbleHolderId){j(al).fadeIn();j(al+" input#a_address").val(ap);j(al+" input#b_address").val(ao);if(M==="miles"){j("input#"+R+"_radio_miles").prop("checked",true);j("input#"+R+"_radio_km").prop("checked",false)}else{if(M==="km"){j("input#"+R+"_radio_km").prop("checked",true);j("input#"+R+"_radio_miles").prop("checked",false)}}}});j(document).on("click",at+" a.dirFromHereTrigger",function(){var au=this.id;if(au==="fromHere-"+ar.bubbleHolderId){j(al).fadeIn();j(al+" input#a_address").val(ao);j(al+" input#b_address").val(ap);if(M==="miles"){j("input#"+R+"_radio_miles").prop("checked",true);j("input#"+R+"_radio_km").prop("checked",false)}else{if(M==="km"){j("input#"+R+"_radio_km").prop("checked",true);j("input#"+R+"_radio_miles").prop("checked",false)}}}});j(document).on("click",al+" div.d_close-wrapper",function(au){V(al);j(this).parent().fadeOut();N.setMap(null);aq.html("");aq.hide();j(al+" button#print_sub").hide();Z();return false})}function O(am,an,al){T.getPanoramaByLocation(am.position,50,function(ap,ao){if(ao===google.maps.StreetViewStatus.OK){j(document).on("click","a#trigger-"+an.bubbleHolderId,function(){var ar={navigationControl:true,enableCloseButton:true,addressControl:false,linksControl:true,scrollwheel:false,addressControlOptions:{position:google.maps.ControlPosition.BOTTOM},position:am.position,pov:{heading:165,pitch:0,zoom:1}};var aq=new google.maps.StreetViewPanorama(document.getElementById("bubble-"+an.bubbleHolderId),ar);aq.setVisible(true);google.maps.event.addListener(Y,"closeclick",function(){V(al);j(al).fadeOut();if(aq!=null){aq.unbind("position");aq.setVisible(false)}aq=null});google.maps.event.addListener(aq,"closeclick",function(){if(aq!=null){aq.unbind("position");aq.setVisible(false);j("div#bubble-"+an.bubbleHolderId).css("background","none")}aq=null})})}else{g.warn("There is not street view available for this marker location: "+am.position+" status: "+ao);j(document).on("click","a#trigger-"+an.bubbleHolderId,function(aq){aq.preventDefault()});j("a#trigger-"+an.bubbleHolderId).attr("style","text-decoration: none !important; color: #ddd !important");google.maps.event.addListener(Y,"domready",function(){j("a#trigger-"+an.bubbleHolderId).removeAttr("href");j("a#trigger-"+an.bubbleHolderId).attr("style","text-decoration: none !important; color: #ddd !important")})}})}function A(){var al="div#direction-controls-placeholder-"+R;var am=j("div#rendered-directions-placeholder-"+R);j(document).on("click",al+" a#reverse-btn",function(ap){var ao=j(al+" input#a_address").val();var an=j(al+" input#b_address").val();j(al+" input#a_address").val(an);j(al+" input#b_address").val(ao);return false});j(document).on("click",al+" a#d_options_show",function(){j(al+" a#d_options_hide").show();j(al+" a#d_options_show").hide();j(al+" div#d_options").show();return false});j(document).on("click",al+" a#d_options_hide",function(){j(al+" a#d_options_hide").hide();j(al+" a#d_options_show").show();j(al+" div#d_options").hide();j("input#"+R+"_avoid_hway").prop("checked",false);j("input#"+R+"_avoid_tolls").prop("checked",false);j("input#"+R+"_radio_km").prop("checked",false);j("input#"+R+"_radio_miles").prop("checked",true);return false});j(document).on("click",al+" button#d_sub",function(){var at=j(al+" input#a_address").val();var aq=j(al+" input#b_address").val();var ap=false;if(at==null||at==""){j(al+" input#a_address").addClass("d_error");ap=true}if(aq==null||aq==""){j(al+" input#b_address").addClass("d_error");ap=true}if(!ap){j(al+" button#d_sub").prop("disabled",true).html("Please wait..");var ao=google.maps.DirectionsTravelMode.DRIVING;if(j(al+" a#dir_w_btn").hasClass("selected")){ao=google.maps.DirectionsTravelMode.WALKING}var au=j("input#"+R+"_avoid_hway").is(":checked");var an=j("input#"+R+"_avoid_tolls").is(":checked");var av=j("input#"+R+"_radio_miles").is(":checked");var ar={origin:at,destination:aq,travelMode:ao,provideRouteAlternatives:true};if(au){ar.avoidHighways=true}if(an){ar.avoidTolls=true}if(av){ar.unitSystem=google.maps.DirectionsUnitSystem.IMPERIAL}else{ar.unitSystem=google.maps.DirectionsUnitSystem.METRIC}ac.route(ar,function(ax,aw){if(aw==google.maps.DirectionsStatus.OK){am.html("");am.show();N.setMap(x);N.setDirections(ax);j(al+" button#d_sub").removeAttr("disabled").html("Get directions");j(al+" button#print_sub").fadeIn();Y.close()}else{g.error('Could not route directions from "'+at+'" to "'+aq+'", got result from Google: '+aw);am.html("<span style='font-size: 12px; font-weight: bold; color: red'>Could not route directions from<br />'"+at+"' to<br />'"+aq+"'<br />Got result from Google: ["+aw+"]</span>");j(al+" button#print_sub").hide();j(al+" button#d_sub").removeAttr("disabled").html("Get directions")}})}});j(document).on("click",al+" button#print_sub",function(){var ar=j(al+" input#a_address").val();var ap=j(al+" input#b_address").val();var aq="d";if(j(al+" a#dir_w_btn").hasClass("selected")){aq="w"}var ao="http://maps.google.com/?saddr="+ar+"&daddr="+ap+"&dirflg="+aq+"&pw=2";var au=j("input#"+R+"_radio_miles").is(":checked");if(au){ao+="&doflg=ptm"}else{ao+="&doflg=ptk"}if(aq==="d"){var at=j("input#"+R+"_avoid_hway").is(":checked");var an=j("input#"+R+"_avoid_tolls").is(":checked");if(at){ao+="&dirflg=h"}if(an){ao+="&dirflg=t"}}window.open(ao);return false});j(document).on("change focus",al+" input#a_address",function(){j(al+" input#a_address").removeClass("d_error");return false});j(document).on("change focus",al+" input#b_address",function(){j(al+" input#b_address").removeClass("d_error");return false});j(document).on("click",al+" .kd-button",function(){var an=this.id;if(an=="dir_d_btn"){if(j(al+" a#dir_d_btn").hasClass("selected")){g.warn("Driving travel mode is already selected")}else{j(al+" a#dir_d_btn").addClass("selected");j(al+" a#dir_w_btn").removeClass("selected")}}else{if(an=="dir_w_btn"){if(j(al+" a#dir_w_btn").hasClass("selected")){g.warn("Walking travel mode is already selected")}else{j(al+" a#dir_w_btn").addClass("selected");j(al+" a#dir_d_btn").removeClass("selected")}}}return false})}function v(ap,am){var an=Math.floor(Math.random()*111111);an=an+"-"+R;var al="<div id='bubble-"+an+"' style='height: 130px !important; width: 300px !important;' class='bubble-content'>";if((!am.geoMashup||(am.geoMashup&&!am.infoBubbleContainPostLink))){al+="<h4>"+SGMPGlobal.address+":</h4>";al+="<p class='custom-bubble-text'>"+ap+"</p>";if(am.customBubbleText!=""){al+="<p class='custom-bubble-text'>"+am.customBubbleText+"</p>"}}else{var ao=am.postTitle.substring(0,30);al+="";al+="<p class='geo-mashup-post-title'><a title='Original post: "+am.postTitle+"' href='"+am.postLink+"'>"+ao+"..</a></p>";al+="<p class='geo-mashup-post-excerpt'>"+am.postExcerpt+"</p>"}al+="<div class='custom-bubble-links-section'>";al+="<hr />";al+="<p class='custom-bubble-text'>"+SGMPGlobal.directions+": <a id='toHere-"+an+"' class='dirToHereTrigger' href='javascript:void(0);'>"+SGMPGlobal.toHere+"</a> - <a id='fromHere-"+an+"' class='dirFromHereTrigger' href='javascript:void(0);'>"+SGMPGlobal.fromHere+"</a> | <a id='trigger-"+an+"' class='streetViewTrigger' href='javascript:void(0);'>"+SGMPGlobal.streetView+"</a></p>";al+="</div></div>";return{bubbleHolderId:an,bubbleContent:al}}function J(ap,am,al){var ao={clickable:false,cursor:"pointer",draggable:false,flat:true,icon:{url:SGMPGlobal.customMarkersUri+"gpsloc.png",size:new google.maps.Size(34,34),scaledSize:new google.maps.Size(17,17),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(8,8)},optimized:false,position:new google.maps.LatLng(0,0),title:"Current location",zIndex:2};if(am){ao=this.copyOptions_(ao,am)}var an={clickable:false,radius:0,strokeColor:"1bb6ff",strokeOpacity:0.4,fillColor:"61a0bf",fillOpacity:0.4,strokeWeight:1,zIndex:1};if(al){an=this.copyOptions_(an,al)}this.marker_=new google.maps.Marker(ao);this.circle_=new google.maps.Circle(an);this.accuracy=null;this.position=null;this.map=null;this.set("minimum_accuracy",null);this.set("position_options",({enableHighAccuracy:true,maximumAge:1000}));this.circle_.bindTo("map",this.marker_);if(ap){this.setMap(ap)}}J.prototype=new google.maps.MVCObject;J.prototype.set=function(al,am){if(/^(?:position|accuracy)$/i.test(al)){throw"'"+al+"' is a read-only property."}else{if(/map/i.test(al)){this.setMap((am))}else{google.maps.MVCObject.prototype.set.apply(this,arguments)}}};J.prototype.marker_=null;J.prototype.circle_=null;J.prototype.getMap=function(){return this.map};J.prototype.getPositionOptions=function(){return(this.get("position_options"))};J.prototype.setPositionOptions=function(al){this.set("position_options",al)};J.prototype.getPosition=function(){return this.position};J.prototype.getBounds=function(){if(this.position){return this.circle_.getBounds()}else{return null}};J.prototype.getAccuracy=function(){return this.accuracy};J.prototype.getMinimumAccuracy=function(){return(this.get("minimum_accuracy"))};J.prototype.setMinimumAccuracy=function(al){this.set("minimum_accuracy",al)};J.prototype.watchId_=-1;J.prototype.setMap=function(al){this.map=al;this.notify("map");if(al){this.watchPosition_()}else{this.marker_.unbind("position");this.circle_.unbind("center");this.circle_.unbind("radius");this.accuracy=null;this.position=null;navigator.geolocation.clearWatch(this.watchId_);this.watchId_=-1;this.marker_.setMap(al)}};J.prototype.setMarkerOptions=function(al){this.marker_.setOptions(this.copyOptions_({},al))};J.prototype.setCircleOptions=function(al){this.circle_.setOptions(this.copyOptions_({},al))};J.prototype.updatePosition_=function(al){var an=new google.maps.LatLng(al.coords.latitude,al.coords.longitude),am=this.marker_.getMap()==null;if(am){if(this.getMinimumAccuracy()!=null&&al.coords.accuracy>this.getMinimumAccuracy()){return}this.marker_.setMap(this.map);this.marker_.bindTo("position",this);this.circle_.bindTo("center",this,"position");this.circle_.bindTo("radius",this,"accuracy")}if(this.accuracy!=al.coords.accuracy){google.maps.MVCObject.prototype.set.call(this,"accuracy",al.coords.accuracy)}if(am||this.position==null||!this.position.equals(an)){google.maps.MVCObject.prototype.set.call(this,"position",an)}};J.prototype.watchPosition_=function(){var al=this;if(navigator.geolocation){this.watchId_=navigator.geolocation.watchPosition(function(am){al.updatePosition_(am)},function(am){google.maps.event.trigger(al,"geolocation_error",am)},this.getPositionOptions())}};J.prototype.copyOptions_=function(an,am){for(var al in am){if(J.DISALLOWED_OPTIONS[al]!==true){an[al]=am[al]}}return an};J.DISALLOWED_OPTIONS={map:true,position:true,radius:true};return{init:ag,setGeoLocationIfEnabled:S,buildAddressMarkers:P,isBuildAddressMarkersCalled:ae}};var l=(function(){var v=function v(w){var x=/^([0-9?(\-.,;\s{1,})]+)$/;return x.test(w)};var t=function t(w){var x=/^([a-zA-Z0-9?(/\-.,\s{1,})]+)$/;return x.test(w)};var s=function s(x){var w=/^\s+|\s+$/g;return x.replace(w,"")};var u=function u(y,x,w){return y.replace(new RegExp(x,"g"),w)};return{isNumeric:v,isAlphaNumeric:t,trim:s,searchReplace:u}})();var g=(function(){var w=function w(y){var z="Info :: "+y;s(z)};var u=function u(y){s(y)};var x=function x(y){var z="Warning :: "+y;s(z)};var t=function t(y){var z="Error :: "+y;s(z)};var v=function v(y){var z="Fatal :: "+y;s(z)};var s=function s(y){if(navigator.userAgent.match(/msie|trident/i)){}else{console.log(y)}};return{info:w,raw:u,warn:x,error:t,fatal:v}})();var p=(function(){var s=function s(x){var B=j('<div id="sgmp-popup-mask"/>');var u=Math.random().toString(36).substring(3);var v=j('<div id="'+u+'" class="sgmp-popup-shortcode-dialog sgmp-popup-window">');v.html("<div class='dismiss-container'><a class='dialog-dismiss' href='javascript:void(0)'>x</a></div><p style='text-align: left; padding: 10px 10px 0 10px'>"+x+"</p><div align='center'><input type='button' class='close-dialog' value='Close' /></div>");j("body").append(B);j("body").append(v);var t=j(document).height();var y=j(window).width();j("#sgmp-popup-mask").css({width:y,height:t,opacity:0.1});if(j("#sgmp-popup-mask").length==1){j("#sgmp-popup-mask").show()}var w=j(window).height();var z=j(window).width();j("div#"+u).css("top",w/2-j("div#"+u).height()/2);j("div#"+u).css("left",z/2-j("div#"+u).width()/2);j("div#"+u).fadeIn(500);j(".sgmp-popup-window .close-dialog").click(function(C){A(C,j(this))});j(".sgmp-popup-window .dialog-dismiss").click(function(C){A(C,j(this))});function A(E,C){E.preventDefault();var D=j(C).closest("div.sgmp-popup-shortcode-dialog");if(D){j(D).remove()}if(j("div.sgmp-popup-shortcode-dialog").length==0){j("#sgmp-popup-mask").remove()}}j("#sgmp-popup-mask").click(function(){j(this).remove();j(".sgmp-popup-window").remove()});j(window).resize(function(){var E=j(".window");var D=j(document).height();var G=j(window).width();j("#sgmp-popup-mask").css({width:G,height:D});var F=j(window).height();var C=j(window).width();E.css("top",F/2-E.height()/2);E.css("left",C/2-E.width()/2)})};return{alertError:s}})();var n=document.head||document.getElementsByTagName("head")[0]||document.documentElement;var m=document.createElement("link");m.type="text/css";m.rel="stylesheet";m.href=SGMPGlobal.cssHref;m.media="screen";n.appendChild(m);var f=parseFloat(j.fn.jquery.split(".")[0]);var r=parseFloat(j.fn.jquery.split(".")[1]);if((f<1)||(f>=1&&f<2&&r<9)){g.fatal("Client uses jQuery older than the version 1.9.0, check if he is using jQuery Migrate plugin")}if(typeof google==="undefined"||!google){g.fatal("We do not have reference to Google API. Aborting map generation ..");return false}else{if(typeof GMap2!=="undefined"&&GMap2){g.fatal("It looks like the webpage has reference to GMap2 object from Google API v2. Aborting map generation ..");return false}}google.load("maps","3",{other_params:"sensor=false&libraries=panoramio&language="+SGMPGlobal.language,callback:function(){h()}});function h(){j("object.sgmp-json-string-placeholder").each(function(w,v){var s=j(v).attr("id");var B=j(v).find("param#json-string-"+s).val();B=l.searchReplace(B,"'","");B=B.replace("&quot;","");var D=o(B);if(typeof D==="undefined"||!D){g.fatal("We did not parse JSON from OBJECT param. Aborting map generation ..");return false}if(j("div#"+D.id).length>0){var C=document.getElementById(D.id);if(SGMPGlobal.mapFillViewport==="true"){if(is_mobile_device()){C.style.width="100%";var u=j(window).height()+"";if(u.indexOf("px")!=-1){C.style.height=u}else{if(u.indexOf("%")!=-1){C.style.height="100%"}else{C.style.height=u+"px"}}}}var A=new google.maps.Map(C);if(typeof D.styles!=="undefined"&&l.trim(D.styles)!==""){D.styles=base64_decode(D.styles);try{D.styles=o(D.styles)}catch(t){g.fatal("Could not parse map styles as a JSON object");D.styles=""}}else{D.styles=""}k.initMap(A,D.bubbleautopan,parseInt(D.zoom),D.maptype,D.styles);q.init(A);var x=new i();x.init(A,D.bubbleautopan,D.distanceunits,D);x.setGeoLocationIfEnabled(D.enablegeolocationmarker);var z={mapTypeControl:(D.maptypecontrol==="true"),panControl:(D.pancontrol==="true"),zoomControl:(D.zoomcontrol==="true"),scaleControl:(D.scalecontrol==="true"),scrollwheel:(D.scrollwheelcontrol==="true"),streetViewControl:(D.streetviewcontrol==="true"),tilt:(D.tiltfourtyfive==="true"?45:null),draggable:(D.draggable==="true"),overviewMapControl:true,overviewMapControlOptions:{opened:false}};k.setMapControls(z);if(D.showpanoramio==="true"){q.buildPanoramioLayer(D.panoramiouid)}if(D.showbike==="true"){q.buildBikeLayer()}if(D.showtraffic==="true"){q.buildTrafficLayer()}if(D.kml!=null&&l.trim(D.kml)!=""){q.buildKmlLayer(D.kml)}else{if(D.markerlist!=null&&l.trim(D.markerlist)!=""){x.buildAddressMarkers(D.markerlist,D.addmarkermashup,D.addmarkermashupbubble)}var y=x.isBuildAddressMarkersCalled();if(!y){g.fatal("No markers specified for the Google map..")}}j(document).ready(function(){var H=null;var J=500;var G="div#"+D.id;if(j(G).is(":hidden")){g.warn("Map placeholder DIV is hidden, must resize the map!");I()}else{H=setTimeout(function(){I()},(J*3))}function I(){if(H!=null){clearTimeout(H)}if(j(G).is(":hidden")){H=setTimeout(I,J)}else{H=setTimeout(function(){E(A)},J)}}function E(K){if(H!=null){clearTimeout(H)}if(K){google.maps.event.trigger(K,"resize");H=setTimeout(function(){F(K)},J/2)}}function F(K){if(H!=null){clearTimeout(H)}if(K){google.maps.event.trigger(K,"click")}}})}else{g.fatal("It looks like the map DIV placeholder ID ["+D.id+"] does not exist in the page!")}})}}(e))}})();function is_mobile_device(){var a=navigator.userAgent;if(typeof a!=="undefined"&&a!=""){return a.match(/Android|BlackBerry|IEMobile|i(Phone|Pad|Pod)|Kindle|MeeGo|NetFront|Nokia|Opera M(ob|in)i|Pie|PalmOS|PDA|Polaris|Plucker|Samsung|SonyEricsson|SymbianOS|UP.Browser|Vodafone|webOS|Windows Phone/i)}return false}function base64_decode(h){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var c,b,a,m,l,k,j,n,g=0,o=0,e="",f=[];if(!h){return h}h+="";do{m=d.indexOf(h.charAt(g++));l=d.indexOf(h.charAt(g++));k=d.indexOf(h.charAt(g++));j=d.indexOf(h.charAt(g++));n=m<<18|l<<12|k<<6|j;c=n>>16&255;b=n>>8&255;a=n&255;if(k==64){f[o++]=String.fromCharCode(c)}else{if(j==64){f[o++]=String.fromCharCode(c,b)}else{f[o++]=String.fromCharCode(c,b,a)}}}while(g<h.length);e=f.join("");return e};